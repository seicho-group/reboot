# Этап сборки приложенияFROM node:18-alpine AS builderWORKDIR /app# Копируем package.json и package-lock.json (или yarn.lock)COPY package*.json ./# Устанавливаем зависимостиRUN npm install# Копируем исходный кодCOPY . .# Собираем приложениеRUN npm run build# Этап productionFROM node:18-alpine AS runnerWORKDIR /app# Копируем только необходимые файлы из builderCOPY --from=builder /app/package*.json ./COPY --from=builder /app/.next ./.nextCOPY --from=builder /app/node_modules ./node_modulesCOPY --from=builder /app/public ./public# Этап с NginxFROM nginx:alpine# Копируем nginx.confCOPY nginx.conf /etc/nginx/conf.d/default.conf# Копируем собранное приложение из runnerCOPY --from=runner /app /usr/share/nginx/html# Открываем порт 80EXPOSE 80# Запускаем NginxCMD ["nginx", "-g", "daemon off;"]